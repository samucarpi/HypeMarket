{% extends 'base.html' %}

{% block head %}
    {% load static %}
    <link rel='stylesheet' href="{% static '/css/prodotto.css' %}">
{% endblock %}

{% block title %}{{ prodotto.titolo }}{% endblock %}

{% block content %}
{{block.super}}
    <div class='container d-flex align-items-center' style='min-height: 90vh;'>
        <div class='row'>
            <div class='col-lg-6 v-100'>
                <div class='row '>
                    <div class='col-12'>
                        <button type='button' class='btn btn-dark' onclick="window.location.href='/sneakers/home'"><i class='bi bi-arrow-left'></i> Indietro</button>
                    </div>
                    <div class='col-12 text-left flex-grow-1' style='white-space: nowrap;'>
                        <br>
                        <h3>{{ prodotto.titolo }}</h3>
                    </div>
                    <div class='col-12 text-center flex-grow-1'>
                        <img style='width:115%;'src='{{ prodotto.immagine }}'>
                    </div>
                    <div class='infos col-12 text-left'>
                        <h4> Dettagli del prodotto: </h4>
                        <br>
                        <p> <b>Modello:</b> {{ prodotto.idModello }} </p>
                        <p> <b>Data di uscita:</b> {{ prodotto.dataRilascio }} </p>
                    </div>
                </div>
            </div>
            <div class='col-lg-1'>
            </div>
            <div class='info col-lg-5'>
                <div class='row'>
                    <div class='col-1'></div>
                    <div class='col-10'>
                        <div class='row contenitore'>
                            <div class='col-6'>
                                <button type='button' id='offri' class='btn btn-dark w-100 disabled'>Offri</button>
                            </div>
                            <div class='col-6'>
                                <button type='button' id='proponi' class='btn btn-dark w-100 disabled'>Proponi</button>
                            </div>
                        </div>
                    </div>
                    <div class='col-1'></div>
                </div>
                <br>
                <div class='contenitore'>
                    <div class=' row'>
                        <div class='col-12 text-center'>
                            <h5>Taglie disponibili:</h5></div>
                        </diV>
                        <div class='row justify-content-center' style='white-space: nowrap;'>
                            {% for taglia in taglie %}
                                <input type='checkbox' class='btn-check' id='{{taglia.taglia}}' autocomplete='off'>
                                <label class=' col-2 m-1 btn btn-outline-dark' for='{{taglia.taglia}}'>
                                    <div class='row'>
                                        <div class='col-12'>
                                            {{ taglia.taglia }}
                                        </div>
                                        <div class='col-12'>
                                            {% if taglia.propostaMinore != None %}
                                                <div class='propostaMinore'>{{ taglia.propostaMinore.prezzo }} €</div>
                                            {% else %}
                                            <div class='propostaMinore'> --- </div>
                                            {% endif %}
                                        </div>
                                        <div class='col-12'>
                                            {% if taglia.offertaMaggiore != None %}
                                                <p class='offertaMaggiore'>{{ taglia.offertaMaggiore.prezzo }} €</p>
                                            {% else %}
                                            <div class='offertaMaggiore'> --- </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                    <br>
                    <div class='row'>
                        <div class='col-6 text-center'>
                            <button type='button' id='vendi' class='btn btn-danger w-100 disabled'>Vendi ora</button>
                        </div>
                        <div class='col-6 text-center'>
                            <button type='button' id='acquista' class='btn btn-success w-100 disabled'>Acquista ora</button>
                        </div>
                    </div>
                    <br>
                </div>
            </div>
        </div>
    </div>
    {% if messages %}
        {% for message in messages %}
            {% if message|stringformat:'s' == 'carta' %}
                <div hidden id='carta'>carta</div>
                <p> carta </p>
                {{ break }}
            {% elif message|stringformat:'s' == 'spedizione' %}
                <div hidden id='spedizione'>spedizione</div>
                <p> spedizione </p>
                {{ break }}
            {% elif message|stringformat:'s' == 'banca' %}
                <div hidden id='banca'>banca</div>
                <p> banca </p>
                {{ break }}
            {% elif message|stringformat:'s' == 'fatturazione' %}
                <div hidden id='fatturazione'>fatturazione</div>
                <p> fatturazione </p>
                {{ break }}
            {% elif message|stringformat:'s' == 'corrispondenteAcquisto' %}
                <div hidden id='corrispondenteAcquisto'>corrispondenteAcquisto</div>
                <h1> corrispondenteAcquisto </h1>
                {{ break }}
            {% elif message|stringformat:'s' == 'corrispondenteVendita' %}
                <div hidden id='corrispondenteVendita'>corrispondenteVendita</div>
                {{ break }}
            {% endif %}
        {% endfor %}
    {% endif %}

{% endblock %}
{% block script%}
<script>
    $(document).ready(function() {

        $('input[type="checkbox"]').on('change', function() {
            $('input[type="checkbox"]').not(this).prop('checked', false);
            if ($(this).is(':checked')) {
                $('#vendi,#acquista,#proponi,#offri ').removeClass('disabled');
            } else {
                $('#vendi,#acquista,#proponi,#offri').addClass('disabled');
            }
        });

        function checkEta(){
            if('{{ eta }}' == 'None'){
                Swal.fire({
                    icon: 'warning',
                    title: 'Attenzione',
                    text: 'Non puoi eseguire azioni se non hai inserito la tua data di nascita',
                });
                return false;
            }else if('{{ eta }}' < 18){
                Swal.fire({
                    icon: 'warning',
                    title: 'Attenzione',
                    text: 'Non puoi eseguire azioni se sei minorenne',
                });
                return false;
            }
            return true;
        }

        $('#offri').on('click', function() {
            if(checkEta()){
                var taglia = $('input[type="checkbox"]:checked').attr('id').trim();
                var prodotto = '{{ prodotto.idModello}}'
                if (taglia) {
                    window.location.href = '/gestione/offerta/'+prodotto+'?taglia=' + taglia;
                }
            }
        });
    
    
        $('#proponi').on('click', function() {
            if(checkEta()){
                var taglia = $('input[type="checkbox"]:checked').attr('id').trim();
                var prodotto = '{{ prodotto.idModello}}'
                if (taglia) {
                    window.location.href = '/gestione/proposta/'+prodotto+'?taglia=' + taglia;
                }
            }
        });
    
        $('#vendi').on('click', function() {
            if(checkEta()){
                errore( $('#corrispondenteVendita'),'Impossibile vendere il prodotto, l\'offerta più alta è la tua');
                var taglia = $('input[type="checkbox"]:checked').attr('id').trim();
                var prodotto = '{{ prodotto.idModello}}'
                var offerta = $('input[type="checkbox"]:checked').next().children().children().last().text().trim();
                if (taglia && (offerta != '---')) {
                    window.location.href = '/gestione/vendita/'+prodotto+'?taglia=' + taglia;
                }else
                {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Attenzione',
                        text: 'Non ci sono offerte valide per questa taglia',
                    });
                }
            }
        });

        $('#acquista').on('click', function() {
            if(checkEta()){
                errore( $('#corrispondenteAcquisto'),'Impossibile acquistare il prodotto, la proposta più bassa è la tua');
                var taglia = $('input[type="checkbox"]:checked').attr('id').trim();
                var prodotto = '{{ prodotto.idModello}}'
                var proposta = $('input[type="checkbox"]:checked').next().children().children().first().next().text().trim();
                if (taglia && (proposta != '---')) {
                    window.location.href = '/gestione/acquisto/'+prodotto+'?taglia=' + taglia;
                }else
                {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Attenzione',
                        text: 'Non ci sono proposte valide per questa taglia',
                    });
                }
            }
        });

        if(checkEta()){
            function errore(oggetto,stringa){
                if (oggetto.text() != ''){
                    Swal.fire({
                        icon: 'warning',
                        title: 'Attenzione',
                        text: stringa,
                    });
                }
            }
           
            errore( $('#spedizione'),'Prima di eseguire l\'azione, inserire l\'indirizzo di spedizione');
            errore( $('#banca'),'Prima di eseguire l\'azione, inserire i dati del conto bancario');
            errore( $('#fatturazione'),'Prima di eseguire l\'azione, inserire l\'indirizzo di fatturazione');
            errore( $('#carta'),'Prima di eseguire l\'azione, inserire i dati della carta di credito');
        }
    });
        
</script>
{%endblock%}